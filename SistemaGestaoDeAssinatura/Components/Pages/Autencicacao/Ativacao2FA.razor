@page "/ativar-2fa"
@layout LoginLayout
@attribute [Authorize]

<PageTitle>Ativar 2FA</PageTitle>

<RadzenCard Style="max-width: 500px; margin: 50px auto;">
    <RadzenStack Gap="1.5rem">
        <RadzenText TextStyle="TextStyle.H3" Align="TextAlign.Center">Ativar Autenticação de Dois Fatores</RadzenText>
        
        @if (ativacao2FA != null && !string.IsNullOrEmpty(ativacao2FA.QRCodeBase64))
        {
            <RadzenStack Gap="1rem">
                <RadzenText Align="TextAlign.Center">Escaneie o QR Code com seu aplicativo autenticador:</RadzenText>
                
                <div style="text-align: center;">
                    <img src="data:image/png;base64,@ativacao2FA.QRCodeBase64" alt="QR Code 2FA" style="max-width: 300px; border: 1px solid #ddd; padding: 10px;" />
                </div>

                <RadzenText Align="TextAlign.Center" Style="font-weight: bold;">Código Manual:</RadzenText>
                <RadzenText Align="TextAlign.Center" Style="font-size: 1.2em; letter-spacing: 2px;">@ativacao2FA.CodigoManual</RadzenText>
                
                <RadzenButton ButtonStyle="ButtonStyle.Secondary" Text="Copiar Código" 
                              Icon="content_copy" Click="@CopiarCodigo" class="rz-col-12" />

                <EditForm Model="@ativacao2FA" OnValidSubmit="@OnSubmit">
                    <RadzenFieldset Text="Validar Código">
                        <RadzenStack Gap="1rem">
                            <RadzenFormField Text="Código de Validação" class="rz-col-12">
                                <RadzenTextBox @bind-Value="@ativacao2FA.CodigoValidacao" 
                                               Placeholder="Digite o código do aplicativo" 
                                               MaxLength="6" style="width: 100%" />
                            </RadzenFormField>

                            @if (!string.IsNullOrEmpty(mensagemErro))
                            {
                                <RadzenAlert AlertStyle="AlertStyle.Danger" Title="Erro" Text="@mensagemErro" />
                            }

                            <RadzenButton ButtonType="ButtonType.Submit" ButtonStyle="ButtonStyle.Primary" 
                                          Text="Ativar 2FA" Icon="verified" class="rz-col-12" IsBusy="@carregando" />
                        </RadzenStack>
                    </RadzenFieldset>
                </EditForm>
            </RadzenStack>
        }
        else if (carregandoQRCode)
        {
            <RadzenProgressBarCircular ShowValue="false" Mode="ProgressBarMode.Indeterminate" />
            <RadzenText Align="TextAlign.Center">Gerando QR Code...</RadzenText>
        }
    </RadzenStack>
</RadzenCard>

